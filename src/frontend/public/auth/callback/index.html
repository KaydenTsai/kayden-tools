<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
</head>
<body>
  <p>Redirecting...</p>
  <script>
    (function() {
      // 手動解析 query string，避免 URLSearchParams 把 + 解碼成空格
      function getQueryParam(name) {
        var regex = new RegExp('[?&]' + name + '=([^&#]*)');
        var match = regex.exec(window.location.search);
        return match ? decodeURIComponent(match[1].replace(/\+/g, '%2B')) : null;
      }

      var code = getQueryParam('code');
      var state = getQueryParam('state');
      var error = getQueryParam('error');
      var errorDescription = getQueryParam('error_description');

      var targetUrl;
      if (error) {
        // 使用者取消授權或發生錯誤
        targetUrl = '/#/auth/callback?error=' + encodeURIComponent(error);
        if (errorDescription) {
          targetUrl += '&error_description=' + encodeURIComponent(errorDescription);
        }
      } else if (code) {
        // 授權成功
        targetUrl = '/#/auth/callback?code=' + encodeURIComponent(code);
        if (state) {
          targetUrl += '&state=' + encodeURIComponent(state);
        }
      } else {
        // 參數不完整，回首頁
        targetUrl = '/';
      }

      window.location.replace(targetUrl);
    })();
  </script>
</body>
</html>
